window.libpannellum=function(t,G,ne){"use strict";function i(P){function O(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function Y(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function W(e,t,r,a,i,o){this.vertices=e,this.side=t,this.level=r,this.x=a,this.y=i,this.path=o.replace("%s",t).replace("%l",r).replace("%x",a).replace("%y",i)}function k(e,t,r,a,i){if(function(e,t){var r=U(e,t.slice(0,3)),a=U(e,t.slice(3,6)),i=U(e,t.slice(6,9)),o=U(e,t.slice(9,12)),n=r[0]+a[0]+i[0]+o[0];if(-4==n||4==n)return!1;var h=r[1]+a[1]+i[1]+o[1];return-4!=h&&4!=h&&r[2]+a[2]+i[2]+o[2]!=4}(e,t.vertices)){var o=t.vertices,n=o[0]+o[3]+o[6]+o[9],h=o[1]+o[4]+o[7]+o[10],s=o[2]+o[5]+o[8]+o[11],u=Math.sqrt(n*n+h*h+s*s),l=Math.asin(s/u),d=Math.atan2(h,n)-a;d+=d>Math.PI?-2*Math.PI:d<-Math.PI?2*Math.PI:0,d=Math.abs(d),t.diff=Math.acos(Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos(d));for(var c=!1,f=0;f<V.nodeCache.length;f++)if(V.nodeCache[f].path==t.path){c=!0,V.nodeCache[f].timestamp=V.nodeCacheTimestamp++,V.nodeCache[f].diff=t.diff,V.currentNodes.push(V.nodeCache[f]);break}if(c||(t.timestamp=V.nodeCacheTimestamp++,V.currentNodes.push(t),V.nodeCache.push(t)),t.level<V.level){var g=$.cubeResolution*Math.pow(2,t.level-$.maxLevel),_=Math.ceil(g*$.invTileResolution)-1,m=g%$.tileResolution*2,v=2*g%$.tileResolution;0===v&&(v=$.tileResolution),0===m&&(m=2*$.tileResolution);var E=.5;t.x!=_&&t.y!=_||(E=1-$.tileResolution/($.tileResolution+v));var x,p=1-E,T=[],R=E,w=E,M=E,A=p,b=p,C=p;v<$.tileResolution&&(t.x==_&&t.y!=_?(b=w=.5,"d"!=t.side&&"u"!=t.side||(C=M=.5)):t.x!=_&&t.y==_&&(A=R=.5,"l"!=t.side&&"r"!=t.side||(C=M=.5))),m<=$.tileResolution&&(t.x==_&&(R=0,A=1,"l"!=t.side&&"r"!=t.side||(M=0,C=1)),t.y==_&&(w=0,b=1,"d"!=t.side&&"u"!=t.side||(M=0,C=1))),x=new W([o[0],o[1],o[2],o[0]*R+o[3]*A,o[1]*E+o[4]*p,o[2]*M+o[5]*C,o[0]*R+o[6]*A,o[1]*w+o[7]*b,o[2]*M+o[8]*C,o[0]*E+o[9]*p,o[1]*w+o[10]*b,o[2]*M+o[11]*C],t.side,t.level+1,2*t.x,2*t.y,$.fullpath),T.push(x),t.x==_&&m<=$.tileResolution||(x=new W([o[0]*R+o[3]*A,o[1]*E+o[4]*p,o[2]*M+o[5]*C,o[3],o[4],o[5],o[3]*E+o[6]*p,o[4]*w+o[7]*b,o[5]*M+o[8]*C,o[0]*R+o[6]*A,o[1]*w+o[7]*b,o[2]*M+o[8]*C],t.side,t.level+1,2*t.x+1,2*t.y,$.fullpath),T.push(x)),t.x==_&&m<=$.tileResolution||t.y==_&&m<=$.tileResolution||(x=new W([o[0]*R+o[6]*A,o[1]*w+o[7]*b,o[2]*M+o[8]*C,o[3]*E+o[6]*p,o[4]*w+o[7]*b,o[5]*M+o[8]*C,o[6],o[7],o[8],o[9]*R+o[6]*A,o[10]*E+o[7]*p,o[11]*M+o[8]*C],t.side,t.level+1,2*t.x+1,2*t.y+1,$.fullpath),T.push(x)),t.y==_&&m<=$.tileResolution||(x=new W([o[0]*E+o[9]*p,o[1]*w+o[10]*b,o[2]*M+o[11]*C,o[0]*R+o[6]*A,o[1]*w+o[7]*b,o[2]*M+o[8]*C,o[9]*R+o[6]*A,o[10]*E+o[7]*p,o[11]*M+o[8]*C,o[9],o[10],o[11]],t.side,t.level+1,2*t.x,2*t.y+1,$.fullpath),T.push(x));for(var I=0;I<T.length;I++)k(e,T[I],r,a,i)}}}function z(e,t,r){var a=Math.sin(t),i=Math.cos(t);return"x"==r?[e[0],i*e[1]+a*e[2],i*e[2]-a*e[1],e[3],i*e[4]+a*e[5],i*e[5]-a*e[4],e[6],i*e[7]+a*e[8],i*e[8]-a*e[7]]:"y"==r?[i*e[0]-a*e[2],e[1],i*e[2]+a*e[0],i*e[3]-a*e[5],e[4],i*e[5]+a*e[3],i*e[6]-a*e[8],e[7],i*e[8]+a*e[6]]:"z"==r?[i*e[0]+a*e[1],i*e[1]-a*e[0],e[2],i*e[3]+a*e[4],i*e[4]-a*e[3],e[5],i*e[6]+a*e[7],i*e[7]-a*e[6],e[8]]:void 0}function H(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]}function q(r){e(r,r.path+"."+$.extension,function(e,t){r.texture=e,r.textureLoaded=t?2:1},S.crossOrigin)}function U(e,t){var r,a,i=(a=t,[(r=e)[0]*a[0]+r[1]*a[1]+r[2]*a[2],r[4]*a[0]+r[5]*a[1]+r[6]*a[2],r[11]+r[8]*a[0]+r[9]*a[1]+r[10]*a[2],1/(r[12]*a[0]+r[13]*a[1]+r[14]*a[2])]),o=i[0]*i[3],n=i[1]*i[3],h=i[2]*i[3],s=[0,0,0];return o<-1&&(s[0]=-1),1<o&&(s[0]=1),n<-1&&(s[1]=-1),1<n&&(s[1]=1),(h<-1||1<h)&&(s[2]=1),s}function B(){console.log("Reducing canvas size due to error 1286!"),ie.width=Math.round(ie.width/2),ie.height=Math.round(ie.height/2)}var V,j,L,D,Z,K,J,Q,$,ee,te,N,re,ae,y,S,ie=G.createElement("canvas");ie.style.width=ie.style.height="100%",P.appendChild(ie),this.init=function(e,t,r,a,i,o,n,h){function s(e){if(c){var t=e*e*4,r=new Uint8ClampedArray(t),a=h.backgroundColor?h.backgroundColor:[0,0,0];a[0]*=255,a[1]*=255,a[2]*=255;for(var i=0;i<t;i++)r[i++]=a[0],r[i++]=a[1],r[i++]=a[2];var o=new ImageData(r,e,e);for(l=0;l<6;l++)0==$[l].width&&($[l]=o)}}if(t===ne&&(t="equirectangular"),"equirectangular"!=t&&"cubemap"!=t&&"multires"!=t)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(ee=t,$=e,te=r,S=h||{},V){if(L&&(j.detachShader(V,L),j.deleteShader(L)),D&&(j.detachShader(V,D),j.deleteShader(D)),j.bindBuffer(j.ARRAY_BUFFER,null),j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,null),V.texture&&j.deleteTexture(V.texture),V.nodeCache)for(var u=0;u<V.nodeCache.length;u++)j.deleteTexture(V.nodeCache[u].texture);j.deleteProgram(V),V=ne}var l;Q=ne;var d,c=!1;if("cubemap"==ee)for(l=0;l<6;l++)0<$[l].width?(d===ne&&(d=$[l].width),d!=$[l].width&&console.log("Cube faces have inconsistent widths: "+d+" vs. "+$[l].width)):c=!0;if("cubemap"==ee&&0!=(d&d-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 10_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||(j||(j=ie.getContext("experimental-webgl",{alpha:!1,depth:!1})),j&&1286==j.getError()&&B()),!j&&("multires"==ee&&$.hasOwnProperty("fallbackPath")||"cubemap"==ee)&&("WebkitAppearance"in G.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){var f;K&&P.removeChild(K),(K=G.createElement("div")).className="pnlm-world",f=$.basePath?$.basePath+$.fallbackPath:$.fallbackPath;var g=["f","r","b","l","u","d"],_=0,m=function(){var e=G.createElement("canvas");e.className="pnlm-face pnlm-"+g[this.side]+"face",K.appendChild(e);var t=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,t.drawImage(this,2,2);var r,a,i=t.getImageData(0,0,e.width,e.height),o=i.data;for(r=2;r<e.width-2;r++)for(a=0;a<4;a++)o[4*(r+e.width)+a]=o[4*(r+2*e.width)+a],o[4*(r+e.width*(e.height-2))+a]=o[4*(r+e.width*(e.height-3))+a];for(r=2;r<e.height-2;r++)for(a=0;a<4;a++)o[4*(r*e.width+1)+a]=o[4*(r*e.width+2)+a],o[4*((r+1)*e.width-2)+a]=o[4*((r+1)*e.width-3)+a];for(a=0;a<4;a++)o[4*(e.width+1)+a]=o[4*(2*e.width+2)+a],o[4*(2*e.width-2)+a]=o[4*(3*e.width-3)+a],o[4*(e.width*(e.height-2)+1)+a]=o[4*(e.width*(e.height-3)+2)+a],o[4*(e.width*(e.height-1)-2)+a]=o[4*(e.width*(e.height-2)-3)+a];for(r=1;r<e.width-1;r++)for(a=0;a<4;a++)o[4*r+a]=o[4*(r+e.width)+a],o[4*(r+e.width*(e.height-1))+a]=o[4*(r+e.width*(e.height-2))+a];for(r=1;r<e.height-1;r++)for(a=0;a<4;a++)o[r*e.width*4+a]=o[4*(r*e.width+1)+a],o[4*((r+1)*e.width-1)+a]=o[4*((r+1)*e.width-2)+a];for(a=0;a<4;a++)o[a]=o[4*(e.width+1)+a],o[4*(e.width-1)+a]=o[4*(2*e.width-2)+a],o[e.width*(e.height-1)*4+a]=o[4*(e.width*(e.height-2)+1)+a],o[4*(e.width*e.height-1)+a]=o[4*(e.width*(e.height-1)-2)+a];t.putImageData(i,0,0),v.call(this)},v=function(){0<this.width?(Z===ne&&(Z=this.width),Z!=this.width&&console.log("Fallback faces have inconsistent widths: "+Z+" vs. "+this.width)):c=!0,6==++_&&(Z=this.width,P.appendChild(K),n())};for(c=!1,l=0;l<6;l++){var E=new Image;E.crossOrigin=S.crossOrigin?S.crossOrigin:"anonymous",E.side=l,E.onload=m,E.onerror=v,E.src="multires"==ee?f.replace("%s",g[l])+"."+$.extension:$[l].src}s(Z)}else{if(!j)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};"cubemap"==ee&&s(d),$.basePath?$.fullpath=$.basePath+$.path:$.fullpath=$.path,$.invTileResolution=1/$.tileResolution;var x=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1];for(J=[],l=0;l<6;l++)J[l]=x.slice(12*l,12*l+12),x=[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1];var p=0;if("equirectangular"==ee){if(p=j.getParameter(j.MAX_TEXTURE_SIZE),Math.max($.width/2,$.height)>p)throw console.log("Error: The image is too big; it's "+$.width+"px wide, but this device's maximum supported size is "+2*p+"px."),{type:"webgl size error",width:$.width,maxWidth:2*p}}else if("cubemap"==ee&&d>j.getParameter(j.MAX_CUBE_MAP_TEXTURE_SIZE))throw console.log("Error: The image is too big; it's "+d+"px wide, but this device's maximum supported size is "+p+"px."),{type:"webgl size error",width:d,maxWidth:p};h===ne||h.horizonPitch===ne&&h.horizonRoll===ne||(Q=[h.horizonPitch==ne?0:h.horizonPitch,h.horizonRoll==ne?0:h.horizonRoll]);var T=j.TEXTURE_2D;if(j.viewport(0,0,j.drawingBufferWidth,j.drawingBufferHeight),j.getShaderPrecisionFormat){var R=j.getShaderPrecisionFormat(j.FRAGMENT_SHADER,j.HIGH_FLOAT);R&&R.precision<1&&(he=he.replace("highp","mediump"))}L=j.createShader(j.VERTEX_SHADER);var w=F;"multires"==ee&&(w=X),j.shaderSource(L,w),j.compileShader(L),D=j.createShader(j.FRAGMENT_SHADER);var M=ue;"cubemap"==ee?(T=j.TEXTURE_CUBE_MAP,M=se):"multires"==ee&&(M=le),j.shaderSource(D,M),j.compileShader(D),V=j.createProgram(),j.attachShader(V,L),j.attachShader(V,D),j.linkProgram(V),j.getShaderParameter(L,j.COMPILE_STATUS)||console.log(j.getShaderInfoLog(L)),j.getShaderParameter(D,j.COMPILE_STATUS)||console.log(j.getShaderInfoLog(D)),j.getProgramParameter(V,j.LINK_STATUS)||console.log(j.getProgramInfoLog(V)),j.useProgram(V),V.drawInProgress=!1;var A=h.backgroundColor?h.backgroundColor:[0,0,0];if(j.clearColor(A[0],A[1],A[2],1),j.clear(j.COLOR_BUFFER_BIT),V.texCoordLocation=j.getAttribLocation(V,"a_texCoord"),j.enableVertexAttribArray(V.texCoordLocation),"multires"!=ee){if(N||(N=j.createBuffer()),j.bindBuffer(j.ARRAY_BUFFER,N),j.bufferData(j.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),j.STATIC_DRAW),j.vertexAttribPointer(V.texCoordLocation,2,j.FLOAT,!1,0,0),V.aspectRatio=j.getUniformLocation(V,"u_aspectRatio"),j.uniform1f(V.aspectRatio,j.drawingBufferWidth/j.drawingBufferHeight),V.psi=j.getUniformLocation(V,"u_psi"),V.theta=j.getUniformLocation(V,"u_theta"),V.f=j.getUniformLocation(V,"u_f"),V.h=j.getUniformLocation(V,"u_h"),V.v=j.getUniformLocation(V,"u_v"),V.vo=j.getUniformLocation(V,"u_vo"),V.rot=j.getUniformLocation(V,"u_rot"),j.uniform1f(V.h,a/(2*Math.PI)),j.uniform1f(V.v,i/Math.PI),j.uniform1f(V.vo,o/Math.PI*2),"equirectangular"==ee&&(V.backgroundColor=j.getUniformLocation(V,"u_backgroundColor"),j.uniform4fv(V.backgroundColor,A.concat([1]))),V.texture=j.createTexture(),j.bindTexture(T,V.texture),"cubemap"==ee)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$[1]),j.texImage2D(j.TEXTURE_CUBE_MAP_NEGATIVE_X,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$[3]),j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_Y,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$[4]),j.texImage2D(j.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$[5]),j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_Z,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$[0]),j.texImage2D(j.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$[2]);else if($.width<=p)j.uniform1i(j.getUniformLocation(V,"u_splitImage"),0),j.texImage2D(T,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$);else{j.uniform1i(j.getUniformLocation(V,"u_splitImage"),1);var b=G.createElement("canvas");b.width=$.width,b.height=$.height;var C=b.getContext("2d");C.drawImage($,0,0);var I=C.getImageData(0,0,$.width/2,$.height);j.texImage2D(T,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,I),V.texture2=j.createTexture(),j.activeTexture(j.TEXTURE1),j.bindTexture(T,V.texture2),j.uniform1i(j.getUniformLocation(V,"u_image1"),1),I=C.getImageData($.width/2,0,$.width/2,$.height),j.texImage2D(T,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,I),j.texParameteri(T,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(T,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(T,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(T,j.TEXTURE_MAG_FILTER,j.LINEAR),j.activeTexture(j.TEXTURE0)}j.texParameteri(T,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(T,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(T,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(T,j.TEXTURE_MAG_FILTER,j.LINEAR)}else V.vertPosLocation=j.getAttribLocation(V,"a_vertCoord"),j.enableVertexAttribArray(V.vertPosLocation),re||(re=j.createBuffer()),ae||(ae=j.createBuffer()),y||(y=j.createBuffer()),j.bindBuffer(j.ARRAY_BUFFER,ae),j.bufferData(j.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),j.STATIC_DRAW),j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,y),j.bufferData(j.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),j.STATIC_DRAW),V.perspUniform=j.getUniformLocation(V,"u_perspMatrix"),V.cubeUniform=j.getUniformLocation(V,"u_cubeMatrix"),V.level=-1,V.currentNodes=[],V.nodeCache=[],V.nodeCacheTimestamp=0;var U=j.getError();if(0!==U)throw console.log("Error: Something went wrong with WebGL!",U),{type:"webgl error"};n()}},this.destroy=function(){if(P!==ne&&(ie!==ne&&P.contains(ie)&&P.removeChild(ie),K!==ne&&P.contains(K)&&P.removeChild(K)),j){var e=j.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var e=t.devicePixelRatio||1;ie.width=ie.clientWidth*e,ie.height=ie.clientHeight*e,j&&(1286==j.getError()&&B(),j.viewport(0,0,j.drawingBufferWidth,j.drawingBufferHeight),"multires"!=ee&&j.uniform1f(V.aspectRatio,ie.clientWidth/ie.clientHeight))},this.resize(),this.setPose=function(e,t){Q=[e,t]},this.render=function(e,t,r,a){var i,o,n,h=0;if(a===ne&&(a={}),a.roll&&(h=a.roll),Q!==ne){var s=Q[0],u=Q[1],l=e,d=t,c=Math.cos(u)*Math.sin(e)*Math.sin(s)+Math.cos(e)*(Math.cos(s)*Math.cos(t)+Math.sin(u)*Math.sin(s)*Math.sin(t)),f=-Math.sin(e)*Math.sin(u)+Math.cos(e)*Math.cos(u)*Math.sin(t),g=Math.cos(u)*Math.cos(s)*Math.sin(e)+Math.cos(e)*(-Math.cos(t)*Math.sin(s)+Math.cos(s)*Math.sin(u)*Math.sin(t));e=Math.asin(Math.max(Math.min(g,1),-1)),t=Math.atan2(f,c);var _=[Math.cos(l)*(Math.sin(u)*Math.sin(s)*Math.cos(d)-Math.cos(s)*Math.sin(d)),Math.cos(l)*Math.cos(u)*Math.cos(d),Math.cos(l)*(Math.cos(s)*Math.sin(u)*Math.cos(d)+Math.sin(d)*Math.sin(s))],m=[-Math.cos(e)*Math.sin(t),Math.cos(e)*Math.cos(t)],v=Math.acos(Math.max(Math.min((_[0]*m[0]+_[1]*m[1])/(Math.sqrt(_[0]*_[0]+_[1]*_[1]+_[2]*_[2])*Math.sqrt(m[0]*m[0]+m[1]*m[1])),1),-1));_[2]<0&&(v=2*Math.PI-v),h+=v}if(j||"multires"!=ee&&"cubemap"!=ee){if("multires"!=ee){var E=2*Math.atan(Math.tan(.5*r)/(j.drawingBufferWidth/j.drawingBufferHeight));i=1/Math.tan(.5*E),j.uniform1f(V.psi,t),j.uniform1f(V.theta,e),j.uniform1f(V.rot,h),j.uniform1f(V.f,i),!0===te&&"equirectangular"==ee&&(j.bindTexture(j.TEXTURE_2D,V.texture),j.texImage2D(j.TEXTURE_2D,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,$)),j.drawArrays(j.TRIANGLES,0,6)}else{var x=(U=r,P=j.drawingBufferWidth/j.drawingBufferHeight,B=.1,L=100,D=2*Math.atan(Math.tan(U/2)*j.drawingBufferHeight/j.drawingBufferWidth),[(N=1/Math.tan(D/2))/P,0,0,0,0,N,0,0,0,0,(L+B)/(B-L),2*L*B/(B-L),0,0,-1,0]);!function(e){for(var t=1;t<$.maxLevel&&j.drawingBufferWidth>$.tileResolution*Math.pow(2,t-1)*Math.tan(e/2)*.707;)t++;V.level=t}(r);var p=[1,0,0,0,1,0,0,0,1];p=z(p=z(p=z(p,-h,"z"),-e,"x"),t,"y"),p=[(I=p)[0],I[1],I[2],0,I[3],I[4],I[5],0,I[6],I[7],I[8],0,0,0,0,1],j.uniformMatrix4fv(V.perspUniform,!1,new Float32Array(H(x))),j.uniformMatrix4fv(V.cubeUniform,!1,new Float32Array(H(p)));var T=(C=p,[(b=x)[0]*C[0],b[0]*C[1],b[0]*C[2],0,b[5]*C[4],b[5]*C[5],b[5]*C[6],0,b[10]*C[8],b[10]*C[9],b[10]*C[10],b[11],-C[8],-C[9],-C[10],0]);if(V.nodeCache.sort(O),200<V.nodeCache.length&&V.nodeCache.length>V.currentNodes.length+50)for(var R=V.nodeCache.splice(200,V.nodeCache.length-200),w=0;w<R.length;w++)j.deleteTexture(R[w].texture);V.currentNodes=[];var M=["f","b","u","d","l","r"];for(n=0;n<6;n++){k(T,new W(J[n],M[n],1,0,0,$.fullpath),e,t,r)}for(V.currentNodes.sort(Y),o=oe.length-1;0<=o;o--)-1===V.currentNodes.indexOf(oe[o].node)&&(oe[o].node.textureLoad=!1,oe.splice(o,1));if(0===oe.length)for(o=0;o<V.currentNodes.length;o++){var A=V.currentNodes[o];if(!A.texture&&!A.textureLoad){A.textureLoad=!0,setTimeout(q,0,A);break}}!function(){if(!V.drawInProgress){V.drawInProgress=!0,j.clear(j.COLOR_BUFFER_BIT);for(var e=0;e<V.currentNodes.length;e++)1<V.currentNodes[e].textureLoaded&&(j.bindBuffer(j.ARRAY_BUFFER,re),j.bufferData(j.ARRAY_BUFFER,new Float32Array(V.currentNodes[e].vertices),j.STATIC_DRAW),j.vertexAttribPointer(V.vertPosLocation,3,j.FLOAT,!1,0,0),j.bindBuffer(j.ARRAY_BUFFER,ae),j.vertexAttribPointer(V.texCoordLocation,2,j.FLOAT,!1,0,0),j.bindTexture(j.TEXTURE_2D,V.currentNodes[e].texture),j.drawElements(j.TRIANGLES,6,j.UNSIGNED_SHORT,0));V.drawInProgress=!1}}()}var b,C,I,U,P,B,L,D,N;if(a.returnImage!==ne)return ie.toDataURL("image/png")}else{var y={f:"translate3d(-"+((n=Z/2)+2)+"px, -"+(n+2)+"px, -"+n+"px)",b:"translate3d("+(n+2)+"px, -"+(n+2)+"px, "+n+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(n+2)+"px, -"+n+"px, "+(n+2)+"px) rotateX(270deg)",d:"translate3d(-"+(n+2)+"px, "+n+"px, -"+(n+2)+"px) rotateX(90deg)",l:"translate3d(-"+n+"px, -"+(n+2)+"px, "+(n+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+n+"px, -"+(n+2)+"px, -"+(n+2)+"px) rotateY(270deg)"},S=(i=1/Math.tan(r/2))*ie.clientWidth/2+"px",G="perspective("+S+") translateZ("+S+") rotateX("+e+"rad) rotateY("+t+"rad) ",F=Object.keys(y);for(o=0;o<6;o++){var X=K.querySelector(".pnlm-"+F[o]+"face");X&&(X.style.webkitTransform=G+y[F[o]],X.style.transform=G+y[F[o]])}}},this.isLoading=function(){if(j&&"multires"==ee)for(var e=0;e<V.currentNodes.length;e++)if(!V.currentNodes[e].textureLoaded)return!0;return!1},this.getCanvas=function(){return ie};var oe=[],e=function(){function e(){var r=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin=o||"anonymous";var e=function(){var e,t;0<r.image.width&&0<r.image.height?(e=r.image,t=r.texture,j.bindTexture(j.TEXTURE_2D,t),j.texImage2D(j.TEXTURE_2D,0,j.RGB,j.RGB,j.UNSIGNED_BYTE,e),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.bindTexture(j.TEXTURE_2D,null),r.callback(r.texture,!0)):r.callback(r.texture,!1),function(e){if(oe.length){var t=oe.shift();e.loadTexture(t.src,t.texture,t.callback)}else h[n++]=e}(r)};this.image.addEventListener("load",e),this.image.addEventListener("error",e)}var o,n=4,h={};e.prototype.loadTexture=function(e,t,r){this.texture=t,this.callback=r,this.image.src=e};for(var t=0;t<n;t++)h[t]=new e;return function(e,t,r,a){o=a;var i=j.createTexture();return n?h[--n].loadTexture(t,i,r):oe.push(new function(e,t,r,a){this.node=e,this.src=t,this.texture=r,this.callback=a}(e,t,i,r)),i}}()}var F=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),X=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join(""),he=["precision highp float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image0;","uniform sampler2D u_image1;","uniform bool u_splitImage;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join("\n"),se=he+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n"),ue=he+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else {","if(u_splitImage) {","if(coord.x < 0.0)","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / u_h, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","else","gl_FragColor = texture2D(u_image1, vec2((coord.x + u_h) / u_h - 1.0, (-coord.y + u_v + u_vo) / (u_v * 2.0)));","} else {","gl_FragColor = texture2D(u_image0, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}","}","}"].join("\n"),le=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(e,t,r,a){return new i(e,t,r,a)}}}(window,document);